<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sovereign Protocol — 21-Day Executive Governance Systems</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.27.0/dist/supabase.min.js"></script>
<script>
  // Initialize Supabase
  const SUPABASE_URL = 'YOUR_SUPABASE_URL';
  const SUPABASE_ANON_KEY = 'YOUR_ANON_KEY';
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // ========= PRICING (single source of truth) =========
  // If you ever change price again, change ONLY these two values.
  const PRICE_USD_NUMBER = 6500;                    // numeric (for display formatting)
  const PRICE_USD_PAYPAL_VALUE = "6500.00";         // string (PayPal requires string)
  const CURRENCY = "USD";
</script>

<style>
body {
  font-family: "Helvetica Neue", Arial, sans-serif;
  background: #0b0b0b;
  color: #f2f2f2;
  margin: 0;
  padding: 40px;
}
.container { max-width: 1000px; margin: auto; }
h1, h2, h3, h4 { letter-spacing: 0.6px; }
.confidential { color: #c7a046; font-weight: bold; letter-spacing: 1px; }
.section { margin-bottom: 70px; }
hr { border: none; border-top: 1px solid #2a2a2a; margin: 50px 0; }

.payment-section { background: #151515; border: 1px solid #c7a046; border-radius: 8px; padding: 50px; margin-bottom: 60px; text-align: center; }
.payment-tier { margin: 40px auto; max-width: 500px; padding: 40px; background: #0e0e0e; border-radius: 8px; border: 1px solid #2a2a2a; }
.tier-price { font-size: 42px; font-weight: bold; color: #c7a046; margin: 20px 0; }
.tier-description { color: #aaa; font-size: 16px; margin: 25px 0; line-height: 1.5; }
.paypal-container { margin-top: 35px; min-height: 55px; }

.status-message { margin-top: 20px; padding: 15px; border-radius: 4px; display: none; }
.status-message.success { background: rgba(39, 174, 96, 0.1); border: 1px solid #27ae60; color: #27ae60; display: block; }
.status-message.error { background: rgba(235, 87, 87, 0.1); border: 1px solid #eb5757; color: #eb5757; display: block; }
.status-message.processing { background: rgba(241, 196, 15, 0.1); border: 1px solid #f1c40f; color: #f1c40f; display: block; }

.gov-day { border: 1px solid #2a2a2a; padding: 28px; margin-bottom: 28px; border-radius: 8px; background: #151515; }
.gov-day.locked { opacity: 0.35; pointer-events: none; }
.gov-day.active { border-color: #c7a046; }
textarea { width: 100%; min-height: 90px; margin-top: 15px; background: #0e0e0e; color: #f2f2f2; border: 1px solid #333; padding: 10px; font-family: "Helvetica Neue", Arial, sans-serif; }
button { background: #c7a046; color: #000; padding: 12px 24px; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; margin-top: 20px; font-family: "Helvetica Neue", Arial, sans-serif; }
button:hover { background: #e0b85a; }
.timer { font-size: 13px; color: #aaa; margin-top: 10px; }
.footer { text-align: center; font-size: 12px; color: #777; margin-top: 90px; }

@media (max-width: 768px) {
  body { padding: 20px; }
  .payment-section, .payment-tier { padding: 30px 20px; }
  .tier-price { font-size: 36px; }
  .container { max-width: 100%; }
}
</style>
</head>

<body>
<div class="container">

<!-- ================= LOGIN / PAYMENT ================= -->
<div class="payment-section" id="login-section">
  <h2>ACTIVATE 21-DAY EXECUTIVE GOVERNANCE SYSTEMS</h2>
  <p class="confidential">CONFIDENTIAL — BOARD & C-SUITE EYES ONLY</p>
  <p>Sign in to access the program or pay if you haven’t yet.</p>

  <div style="margin: 25px 0;">
    <input type="email" id="login-email" placeholder="Email" style="padding: 10px; width: 220px; margin-right: 10px;">
    <input type="password" id="login-password" placeholder="Password" style="padding: 10px; width: 220px;">
    <button type="button" onclick="signIn()">Sign In</button>
  </div>

  <div class="status-message" id="login-status"></div>

  <hr>

  <div class="payment-tier">
    <h3>21-Day Executive Governance Installation</h3>

    <!-- Display price (fixed) -->
    <div class="tier-price" id="tier-price">$6,500</div>

    <p class="tier-description">
      Complete access to the 21-Day Executive Governance Systems<br>
      One governance layer installed per day<br>
      Institutional decision architecture<br>
      Board-grade governance protocols
    </p>

    <div id="paypal-button-container"></div>
    <div class="status-message" id="payment-status"></div>
  </div>
</div>

<!-- ================= PROGRAM CONTENT ================= -->
<div id="program-content" style="display:none;">

<h1>SOVEREIGN PROTOCOL</h1>
<h2>21-Day Executive Governance Systems</h2>
<p class="confidential">CONFIDENTIAL — BOARD & C-SUITE EYES ONLY</p>
<p>If you are here, the 7-Day Foundations have done their work. Your internal operating system is aligned.</p>
<hr>

<div class="section" id="governance-installation">
  <!-- Example: Week 1 -->
  <div class="gov-day active" data-day="1">
    <h4>Day 1 — Final Decision Authority</h4>
    <p>Define which decisions require you — and which categorically do not.</p>
    <textarea placeholder="State the non-negotiable rule you will now enforce."></textarea>
    <button type="button" onclick="completeDay(1)">Confirm & Install</button>
    <div class="timer" id="timer-1"></div>
  </div>

  <div class="gov-day locked" data-day="2">
    <h4>Day 2 — Cognitive Load Governance</h4>
    <p>Codify which decisions are forbidden from entering your cognitive space.</p>
    <textarea placeholder="List decisions now barred from your attention."></textarea>
    <button type="button" onclick="completeDay(2)">Confirm & Install</button>
    <div class="timer" id="timer-2"></div>
  </div>

  <!-- Repeat all 21 days in the same pattern -->
</div>

<div class="footer">
© Sovereign Protocol — Executive Governance Architecture<br>
<small>Need support? Contact: support@sovereignprotocol.org</small>
</div>

</div> <!-- End program-content -->
</div> <!-- End container -->

<!-- PayPal SDK MUST load BEFORE we call paypal.Buttons() -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD&intent=capture"></script>

<script>
  // ----------------- PRICE DISPLAY INIT -----------------
  (function initPrice(){
    const el = document.getElementById("tier-price");
    if (!el) return;
    const formatted = new Intl.NumberFormat("en-US", { style: "currency", currency: CURRENCY, maximumFractionDigits: 0 })
      .format(PRICE_USD_NUMBER);
    el.textContent = formatted; // e.g., $6,500
  })();

  // ----------------- AUTH -----------------
  async function signIn() {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value.trim();
    const statusEl = document.getElementById('login-status');

    if (!email || !password) {
      statusEl.className = 'status-message error';
      statusEl.innerText = '❌ Enter both email and password.';
      return;
    }

    const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });

    if (error) {
      statusEl.className = 'status-message error';
      statusEl.innerText = '❌ ' + error.message;
      return;
    }

    // Check access in Supabase
    const { data: accessData, error: accessError } = await supabaseClient
      .from('user_access')
      .select('has_access')
      .eq('user_id', data.user.id)
      .single();

    if (accessError) {
      statusEl.className = 'status-message error';
      statusEl.innerText = '❌ Access check failed. Please contact support.';
      return;
    }

    if (accessData && accessData.has_access) {
      statusEl.className = 'status-message success';
      statusEl.innerText = '✅ Access granted!';
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('program-content').style.display = 'block';
    } else {
      statusEl.className = 'status-message error';
      statusEl.innerText = '❌ Payment required to access the program.';
    }
  }

  // ----------------- DAY UNLOCK -----------------
  const LOCK_HOURS = 24;

  function completeDay(day) {
    const text = document.querySelector(`[data-day="${day}"] textarea`).value.trim();
    if (!text) { alert("Please complete the prompt before proceeding."); return; }
    localStorage.setItem("gov_day_" + day, Date.now());
    updateAccess();
    alert(`Day ${day} completed! Next day unlocks in 24 hours.`);
  }

  function updateAccess() {
    document.querySelectorAll(".gov-day").forEach(el => {
      const day = parseInt(el.getAttribute("data-day"), 10);
      if (day === 1) return;

      const prevCompleted = localStorage.getItem("gov_day_" + (day - 1));
      if (!prevCompleted) return;

      const unlockTime = parseInt(prevCompleted, 10) + LOCK_HOURS * 60 * 60 * 1000;
      const now = Date.now();

      if (now >= unlockTime) {
        el.classList.remove('locked');
        el.classList.add('active');
        const t = document.getElementById("timer-" + day);
        if (t) t.innerText = "";
      } else {
        const remaining = unlockTime - now;
        const hrs = Math.floor(remaining / (1000 * 60 * 60));
        const mins = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
        const secs = Math.floor((remaining % (1000 * 60)) / 1000);
        const t = document.getElementById("timer-" + day);
        if (t) t.innerText = `Unlocks in ${hrs}h ${mins}m ${secs}s`;
      }
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    updateAccess();
    setInterval(updateAccess, 1000);
  });

  // ----------------- PAYPAL -----------------
  (function initPayPal(){
    const statusEl = document.getElementById("payment-status");

    if (!window.paypal || !paypal.Buttons) {
      if (statusEl) {
        statusEl.className = "status-message error";
        statusEl.innerText = "❌ PayPal SDK failed to load. Check your client-id.";
      }
      return;
    }

    paypal.Buttons({
      style: { color: 'gold', shape: 'rect', label: 'pay', height: 40 },

      // FIXED: amount now matches $6,500
      createOrder: (data, actions) => actions.order.create({
        purchase_units: [{
          amount: { value: PRICE_USD_PAYPAL_VALUE, currency_code: CURRENCY },
          description: "Sovereign Protocol — 21-Day Executive Governance Installation"
        }]
      }),

      onApprove: (data, actions) => actions.order.capture().then(details => {
        // NOTE: This does NOT automatically grant access in Supabase yet.
        // You still need a backend (Netlify Function / server) to mark has_access=true.
        if (statusEl) {
          statusEl.className = "status-message success";
          statusEl.innerText = "✅ Payment successful. Please refresh and sign in to access.";
        } else {
          alert("✅ Payment successful! Refresh and sign in to access.");
        }
      }),

      onError: err => {
        if (statusEl) {
          statusEl.className = "status-message error";
          statusEl.innerText = "❌ Payment failed. Please try again.";
        } else {
          alert("❌ Payment failed: " + err);
        }
        console.error(err);
      }
    }).render('#paypal-button-container');
  })();
</script>

</body>
</html>
