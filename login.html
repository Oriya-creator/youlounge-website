<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login — Sovereign Protocol</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "PASTE_YOUR_PROJECT_URL";
    const SUPABASE_ANON_KEY = "PASTE_YOUR_ANON_PUBLIC_KEY";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function qp(name){
      const u = new URL(window.location.href);
      return u.searchParams.get(name);
    }
  </script>

  <style>
    :root{--bg:#0b0b0b;--panel:#141414;--gold:#c7a046;--text:#f2f2f2;--muted:#bdbdbd;--border:#2a2a2a;}
    body{margin:0;padding:40px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:720px;margin:0 auto;}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:28px;}
    h1{margin:0 0 8px;letter-spacing:.4px;}
    p{margin:0 0 18px;color:var(--muted);line-height:1.5;}
    label{display:block;margin:12px 0 6px;color:var(--muted);font-size:14px;}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0e0e0e;color:var(--text);outline:none;}
    input:focus{border-color:rgba(199,160,70,.7);box-shadow:0 0 0 4px rgba(199,160,70,.12);}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px;}
    button{border:0;border-radius:10px;padding:12px 16px;font-weight:800;cursor:pointer;background:var(--gold);color:#000;}
    button.secondary{background:#222;color:#fff;border:1px solid #333;}
    .status{margin-top:14px;padding:12px;border-radius:10px;display:none;}
    .ok{display:block;border:1px solid rgba(39,174,96,.6);color:#27ae60;background:rgba(39,174,96,.08);}
    .err{display:block;border:1px solid rgba(235,87,87,.6);color:#eb5757;background:rgba(235,87,87,.08);}
    .small{font-size:12px;color:var(--muted);margin-top:16px;}
    a{color:var(--gold);text-decoration:none;}
    a:hover{text-decoration:underline;}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>Secure Login</h1>
    <p>Sign in to access your Sovereign Protocol programs. If you don’t have an account yet, create one.</p>

    <label for="email">Email</label>
    <input id="email" type="email" autocomplete="email" placeholder="you@company.com" />

    <label for="password">Password</label>
    <input id="password" type="password" autocomplete="current-password" placeholder="••••••••" />

    <div class="row">
      <button type="button" onclick="signIn()">Sign In</button>
      <button type="button" class="secondary" onclick="signUp()">Create Account</button>
      <button type="button" class="secondary" onclick="resetPassword()">Reset Password</button>
    </div>

    <div id="status" class="status"></div>

    <p class="small">
      After login, you’ll be returned to your course or the payment page automatically.
    </p>
  </div>
</div>

<script>
  const statusEl = document.getElementById("status");

  function setStatus(kind, msg){
    statusEl.className = "status " + (kind === "ok" ? "ok" : "err");
    statusEl.textContent = msg;
  }

  function getReturnUrl(){
    // optional: ?return=/90daysexecutive.html
    const r = qp("return");
    return r && r.startsWith("/") ? r : "/hubs.html";
  }

  async function signIn(){
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    if(!email || !password) return setStatus("err","Enter email + password.");

    const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
    if(error) return setStatus("err", error.message);

    setStatus("ok","Signed in. Redirecting…");
    window.location.href = getReturnUrl();
  }

  async function signUp(){
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    if(!email || !password) return setStatus("err","Enter email + password.");

    const { data, error } = await supabaseClient.auth.signUp({ email, password });
    if(error) return setStatus("err", error.message);

    // If email confirmation is ON, user must confirm first.
    setStatus("ok","Account created. If email confirmation is enabled, check your inbox. Then sign in.");
  }

  async function resetPassword(){
    const email = document.getElementById("email").value.trim();
    if(!email) return setStatus("err","Enter your email first.");

    // IMPORTANT: set this to your real reset page later if you build one
    const redirectTo = window.location.origin + "/login.html";
    const { data, error } = await supabaseClient.auth.resetPasswordForEmail(email, { redirectTo });
    if(error) return setStatus("err", error.message);

    setStatus("ok","Password reset email sent (if the address exists).");
  }
</script>
</body>
</html>
